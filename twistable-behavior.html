<!--
@license
Copyright (c) 2015 Teo Maragakis. All rights reserved.
This code may only be used under the MIT style license found at https://raw.githubusercontent.com/teomaragakis/polymer-knobs/master/LICENSE
The complete set of authors and contributors may be found at https://raw.githubusercontent.com/teomaragakis/polymer-knobs/master/humans.txt

Code distributed by Google as part of the polymer project is also
subject to an additional IP rights grant found at http://polymer.github.io/PATENTS.txt
-->
<link rel="import" href="../polymer/polymer.html">
<script>
  /**
   * Use `TwistableBehavior` to make things rotate!
   *
   * @polymerBehavior TwistableBehavior
   */
  TwistableBehavior = {
    properties: {
      /* Defines the knob's maximum angle in degrees. Has a maximum of 180 (half a circle). */
      maxAngle: {
        type: Number,
        value: 90
      }
    },
    listeners: {
      'wheel': 'handleWheel',
      'track': 'handleTrack'
    },
    created: function() {
      //this.maxAngle = Math.min(Math.max(parseInt(this.maxAngle), 1), 180);
      if (this.maxAngle > 180)
      this.maxAngle = 180;
    },
    /* Gets the delta from wheel events */
    handleWheel: function(e) {
      e.preventDefault();
      var deltaSum = 0;
      deltaSum += e.deltaY;
      this.debounce(
        'set-angle',
        (function() {
          this.setAngle(deltaSum);
        }).bind(this),
        100
      );
    },
    /* Gets the delta from drag (touch) events. Drag horizontally. */
    handleTrack: function(e) {
      e.preventDefault();
      var dxSum = 0;
      dxSum += e.detail.dx;
      this.debounce(
        'set-angle',
        (function() {
          this.setAngle(deltaSum);
        }).bind(this),
        100
      );
    },
    /* Limits the rotation within the given limits and rotates the movable part via CSS. */
    setAngle: function(rotation) {
      rotation = Math.min(Math.max(parseInt(rotation), this.maxAngle * -1), this.maxAngle);
      this.transform('rotate('+ rotation +'deg)', this.$.chamfer);
    }
  };
</script>
